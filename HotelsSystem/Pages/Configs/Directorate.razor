@inject IStringLocalizer<App> L;

@if(config!=null){
    <div class="row g-3 m-0 w-100">
        <MudForm @ref="AddForm" Class="row g-3 m-0 w-100 p-0">
        <div class="col-12 col-md-4 col-lg-3 col-xxl-2">
            <MudTextField Required="true" Margin="@Margin.Dense" ErrorText="@L["required"]" Dense="true" @bind-Value="SelectedDirectorate.peo_DirectorateName" Label=@L["name"] Variant="Variant.Outlined"></MudTextField>
        </div>
        <div class="col-12 col-md-4 col-lg-3 col-xxl-2">

            <MudAutocomplete T="UserInfo" DebounceInterval="ClS_Config.debounce"
                         SearchFunc="@SearchUser"
                         Clearable="true"
                         Required="true"
                         ResetValueOnEmptyText="true"
                         Value="@(new UserInfo(){peo_UserName=SelectedDirectorate.peo_UserName,peo_UserID=SelectedDirectorate.peo_dirAdminUserID})"
                         Text="@SelectedDirectorate.peo_UserName"
                         Validation="@(new Func<UserInfo, string>((e)=>e.ValidateField<UserInfo>("peo_UserID")))"
                         ValueChanged="@((e)=>OnUserChanged(e))"
                         ToStringFunc="@(e=>e==null?"":e.peo_UserName)"
                         CoerceText="@true"
                         Label=@L["user"]
                         Margin="@Margin.Dense" Dense="true" Variant="Variant.Outlined"
                         AdornmentIcon="@Icons.Material.Rounded.KeyboardArrowDown" IconSize="Size.Small" />

        </div>
        <div class="col-12 col-md-4 col-lg-3 col-xxl-2 pt-1">
            <MudIconButton Icon="@Icons.Material.Filled.Add" OnClick="@(async()=>await InsertUpdateDirectorate())" Variant="Variant.Filled" Color="Color.Primary" />
        </div>
        </MudForm>
        <div class="col-12">

            <MudTable @ref="@tableRef" Outlined="true" Elevation="0"
                  ServerData="@(new Func<TableState,Task<TableData<DirectorateInfo>>>(GetPaginatedItems))"
                  TotalItems="PaginatedDirectorate.TotalItems" Items="@PaginatedDirectorate.Items" T="DirectorateInfo" Dense="true"
                >
               @* <ToolBarContent>
                    <MudText Typo="Typo.h6">Directorate</MudText>
                    <MudSpacer />
                    <MudTextField @bind-Value="Filter.peo_DirectorateName" Placeholder="Search" Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
                </ToolBarContent>*@
                <HeaderContent>
                    <MudTh>
                        <MudTableSortLabel SortLabel="peo_DirectorateName" SortBy="new Func<DirectorateInfo, object>(x=>x.peo_DirectorateName.ToEmptyOnNull())">
                            @L["directories"]
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel SortLabel="peo_UserName" SortBy="new Func<DirectorateInfo, object>(x=>x.peo_UserName.ToEmptyOnNull())">
                            @L["name"]
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh></MudTh>

                </HeaderContent>

                <RowTemplate>
                    <MudTd DataLabel="">
                        @context.peo_DirectorateName
                    </MudTd>
                    <MudTd DataLabel="">@context.peo_UserName</MudTd>
                    <MudTd Class="text-end">
                        <MudIconButton Icon="@Icons.Material.Filled.Edit" Variant="Variant.Text" OnClick="@(async()=> await GetDirectorateByID(context.peo_DirectorateID))"  Color="Color.Primary" />
                    </MudTd>
                </RowTemplate>

            @*    <RowEditingTemplate>
                    <MudTd>@context.peo_DirectorateName</MudTd>
                    <MudTd>@context.peo_UserName</MudTd>
                  
                </RowEditingTemplate>*@
                <PagerContent>
                    <MudTablePager />
                </PagerContent>
              @*  <EditButtonContent Context="button">
                    <MudIconButton Size="@Size.Small" Icon="@Icons.Outlined.Edit" Class="pa-0"
                               OnClick="@button.ButtonAction" Disabled="@button.ButtonDisabled" />
                </EditButtonContent>*@
            </MudTable>
         
        </div>
    </div>
}
